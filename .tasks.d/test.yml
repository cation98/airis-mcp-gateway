version: '3'

tasks:
  health:
    desc: Check API health
    cmds:
      - curl -sf http://localhost:9400/health | jq .

  status:
    desc: Check server status
    cmds:
      - curl -sf http://localhost:9400/api/tools/status | jq '.servers[] | {name, status, tools_count}'

  tools:
    desc: List all available tools
    cmds:
      - curl -sf http://localhost:9400/api/tools/combined | jq '{tools_count, sources}'

  tools:count:
    desc: Count total tools
    cmds:
      - curl -sf http://localhost:9400/api/tools/combined | jq '.tools_count'

  prewarm:
    desc: Check pre-warm status from logs
    cmds:
      - docker compose logs api 2>&1 | grep -E "Pre-warm" | tail -10

  e2e:
    desc: Run end-to-end test suite
    cmds:
      - echo "=== Gateway Health ==="
      - task: health
      - echo ""
      - echo "=== Server Status ==="
      - task: status
      - echo ""
      - echo "=== Tool Count ==="
      - task: tools:count
      - echo ""
      - echo "=== Pre-warm Status ==="
      - task: prewarm
      - echo ""
      - echo "âœ“ All checks passed"

  api:
    desc: Run Python API tests
    cmds:
      - docker compose exec api pytest tests/ -v
