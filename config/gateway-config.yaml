# AIRIS MCP Gateway - Capability-Driven Configuration
# Version: 1.0.0
#
# This configuration defines the 7-verb capability model and maps
# user intents to specific MCP server implementations.
#
# Capabilities: search, summarize, retrieve, plan, edit, execute, record

version: "1.0"

# =============================================================================
# CAPABILITY DEFINITIONS
# =============================================================================
capabilities:
  # ---------------------------------------------------------------------------
  # SEARCH: Web, documentation, and code search
  # ---------------------------------------------------------------------------
  search:
    description: "Web/docs/code search capabilities"
    implementations:
      - name: tavily
        priority: 1
        mode: cold
        conditions:
          intents: [web_search, current_events, deep_research, market_analysis]
        config:
          api_key: "${TAVILY_API_KEY}"

      - name: context7
        priority: 2
        mode: cold
        conditions:
          intents: [library_docs, api_reference, framework_docs, official_docs]
        config:
          # No API key required - uses Upstash public endpoint

      - name: fetch
        priority: 3
        mode: cold
        conditions:
          intents: [specific_url, http_request, webpage_content]

    fallback: fetch

  # ---------------------------------------------------------------------------
  # SUMMARIZE: Extract, analyze, compare
  # ---------------------------------------------------------------------------
  summarize:
    description: "Extraction, analysis, and comparison capabilities"
    implementations:
      - name: sequential-thinking
        priority: 1
        mode: cold
        conditions:
          intents: [complex_analysis, multi_step_reasoning, security_audit]
          complexity: [high, very_high]

      - name: native
        priority: 2
        mode: null  # Native LLM capability
        conditions:
          intents: [simple_explanation, quick_summary]
          complexity: [low, medium]

    fallback: native

  # ---------------------------------------------------------------------------
  # RETRIEVE: Knowledge base access
  # ---------------------------------------------------------------------------
  retrieve:
    description: "Knowledge base and memory retrieval"
    implementations:
      - name: mindbase
        priority: 1
        mode: hot
        conditions:
          intents: [cross_session_memory, project_knowledge, semantic_search]
          scope: [project, global, cross_session]
        config:
          url: "${MINDBASE_URL:-http://localhost:18003}"

      - name: memory
        priority: 2
        mode: hot
        conditions:
          intents: [session_memory, temporary_storage]
          scope: [session]

    fallback: memory

  # ---------------------------------------------------------------------------
  # PLAN: Task decomposition and strategy
  # ---------------------------------------------------------------------------
  plan:
    description: "Task planning, decomposition, and strategy"
    implementations:
      - name: airis-agent
        priority: 1
        mode: hot
        conditions:
          intents: [pdca_cycle, confidence_check, complex_planning, project_management]
          complexity: [high, very_high]
          features: [self_correction, reflexion]

      - name: sequential-thinking
        priority: 2
        mode: cold
        conditions:
          intents: [simple_planning, step_decomposition]
          complexity: [medium]

      - name: native
        priority: 3
        mode: null
        conditions:
          intents: [quick_plan]
          complexity: [low]

    fallback: native

  # ---------------------------------------------------------------------------
  # EDIT: File editing and refactoring
  # ---------------------------------------------------------------------------
  edit:
    description: "File editing, refactoring, and code changes"
    implementations:
      - name: serena
        priority: 1
        mode: cold
        conditions:
          intents: [semantic_refactoring, multi_file_edit, codebase_navigation]
          scope: [multi_file, project_wide]

      - name: native
        priority: 2
        mode: null
        conditions:
          intents: [single_file_edit, quick_fix]
          scope: [single_file]

    fallback: native

  # ---------------------------------------------------------------------------
  # EXECUTE: Script and workflow execution
  # ---------------------------------------------------------------------------
  execute:
    description: "Script, command, and workflow execution"
    implementations:
      - name: bash
        priority: 1
        mode: null  # Native shell
        conditions:
          intents: [shell_command, script_execution, build_run]

      - name: airis-agent
        priority: 2
        mode: hot
        conditions:
          intents: [orchestrated_workflow, multi_step_execution, agent_coordination]

    fallback: bash

  # ---------------------------------------------------------------------------
  # RECORD: Memory storage and observations
  # ---------------------------------------------------------------------------
  record:
    description: "Memory storage, observations, and learning capture"
    implementations:
      - name: mindbase
        priority: 1
        mode: hot
        conditions:
          intents: [long_term_memory, semantic_storage, cross_session_learning]
          persistence: [permanent, long_term]
        config:
          url: "${MINDBASE_URL:-http://localhost:18003}"

      - name: memory
        priority: 2
        mode: hot
        conditions:
          intents: [session_notes, temporary_record]
          persistence: [session, temporary]

    fallback: memory


# =============================================================================
# INTENT PATTERNS
# =============================================================================
# These patterns help route natural language to capabilities
intent_patterns:
  # Search intents
  web_search:
    patterns:
      - "search for"
      - "find online"
      - "look up"
      - "what is the latest"
      - "search the web"
    capability: search
    implementation_hint: tavily

  library_docs:
    patterns:
      - "how do I use"
      - "documentation for"
      - "api reference"
      - "official docs"
      - "best practices for"
    capability: search
    implementation_hint: context7

  # Summarize intents
  security_analysis:
    patterns:
      - "security review"
      - "vulnerability check"
      - "owasp compliance"
      - "security audit"
    capability: summarize
    implementation_hint: sequential-thinking

  code_explanation:
    patterns:
      - "explain this code"
      - "what does this do"
      - "how does this work"
    capability: summarize

  # Retrieve intents
  recall_knowledge:
    patterns:
      - "what did we decide"
      - "recall"
      - "what was"
      - "previous session"
    capability: retrieve
    implementation_hint: mindbase

  # Plan intents
  task_planning:
    patterns:
      - "plan out"
      - "break down"
      - "how should I implement"
      - "create a roadmap"
      - "what are the steps"
    capability: plan
    implementation_hint: airis-agent

  # Edit intents
  code_refactoring:
    patterns:
      - "refactor"
      - "rename across"
      - "restructure"
      - "clean up the code"
    capability: edit
    implementation_hint: serena

  # Execute intents
  run_command:
    patterns:
      - "run"
      - "execute"
      - "build"
      - "test"
    capability: execute

  # Record intents
  store_knowledge:
    patterns:
      - "remember this"
      - "save for later"
      - "note that"
      - "store this pattern"
    capability: record
    implementation_hint: mindbase


# =============================================================================
# SERVER MODE CONFIGURATION
# =============================================================================
# HOT: Always running, immediate response (<100ms)
# COLD: Started on-demand, may have startup latency (1-5s)

server_modes:
  hot:
    description: "Always-on servers for immediate response"
    servers:
      - airis-agent      # PDCA orchestration
      - mindbase         # Long-term memory
      - memory           # Session memory
    characteristics:
      startup_time: "0ms"
      token_cost: "baseline"

  cold:
    description: "On-demand servers to minimize baseline tokens"
    servers:
      - tavily           # Web search
      - context7         # Library docs
      - fetch            # HTTP requests
      - sequential-thinking  # Complex reasoning
      - serena           # Semantic code ops
    characteristics:
      startup_time: "1-5s"
      token_cost: "pay-per-use"


# =============================================================================
# ROUTING RULES
# =============================================================================
routing:
  # Default behavior when intent is unclear
  default_capability: plan
  default_implementation: airis-agent

  # Confidence thresholds
  thresholds:
    high_confidence: 0.9    # Route directly
    medium_confidence: 0.7  # Route with confirmation
    low_confidence: 0.5     # Ask user to clarify

  # Fallback chain when primary fails
  fallback_chain:
    - native        # Try LLM native capability
    - ask_user      # Ask user for guidance


# =============================================================================
# LOGGING
# =============================================================================
logging:
  level: info
  include_routing_decisions: true
  include_intent_detection: true
